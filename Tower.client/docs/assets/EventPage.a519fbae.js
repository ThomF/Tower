import{j as v,l as r,A as n,_ as T,u as I,k as x,m as S,n as E,c as u,P as l,a,b as t,g as y,t as _,F as f,r as w,q as B,s as D,v as A,d,p as N,h as G,e as H,x as L}from"./index.5c36e24e.js";class M{async getTicketHolders(o){const c=await v.get(`api/events/${o}/tickets`);r.log("[getting ticket holders]",c.data),n.tickets=c.data}async createTicket(o){const c=await v.post("api/tickets",o);r.log("[Getting Ticket for Event!]",c.data),n.tickets.push(c.data);const s=n.event;n.myTicket.push(s),s.capacity--}async removeTicket(o){r.log(o);const c=await v.delete(`api/tickets/${o}`);r.log("[Cancelling myTicket]",c.data);const s=n.tickets.findIndex(g=>g.id==o);r.log(s),s!==-1&&n.tickets.splice(s,1)}}const k=new M;class C{constructor(o){this.eventId=o.eventId,this.body=o.body,this.id=o.id,this.picture=o.creator.picture,this.name=o.creator.name,this.creatorId=o.creatorId}}class O{async createComment(o){const c=await v.post("api/comments",o);r.log("GETTING DA COMMENTS",c.data),n.comments.push(new C(c.data))}async getCommentsByEvent(o){n.comments=[];const c=await v.get("api/events/"+o+"/comments");r.log("[Getting comments by event]",c.data),n.comments=c.data.map(s=>new C(s))}async delete(o){await v.delete("api/comments/"+o);let c=n.comments.findIndex(s=>s.id==o);c!=-1&&n.comments.splice(c,1)}}const p=new O;const P={setup(){const i=I(),o=x(),c=S({});async function s(){try{const e=i.params.eventId;await H.getEventById(e)}catch{l.error("How did we get here?"),o.push("/")}}async function g(){try{const e=i.params.eventId;await k.getTicketHolders(e)}catch(e){r.error(e),l.error(message.error)}}async function b(){try{const e=i.params.eventId;await p.getCommentsByEvent(e)}catch(e){r.error(e),l.error(e.message)}}return E(()=>{i.params.eventId&&(s(),g(),b())}),{editable:c,route:i,event:u(()=>n.event),ticket:u(()=>n.tickets),account:u(()=>n.account),comments:u(()=>n.comments),myTicket:u(()=>n.tickets.find(e=>e.accountId==n.account.id)),async createTicket(){try{await k.createTicket({eventId:i.params.eventId})}catch(e){r.error(e),l.error(e.message)}},async removeTicket(e){try{await l.confirm("Are You Sure You Want To Cancel Your Ticket?")&&await k.removeTicket(e)}catch(h){l.error(h.message),r.log(h)}},async createComment(){try{const e=c.value;e.eventId=i.params.eventId,await p.createComment(e),c.value={}}catch(e){r.error(e),l.error(e.message)}},async deleteComment(e){try{await l.confirm()&&(await p.delete(e),l.success("Deleted Comment"))}catch(h){l.error(h,"failed to delete")}}}}},m=i=>(N("data-v-c53cdb19"),i=i(),G(),i),V={key:0},Y={class:"container-fluid"},j={key:0,class:"row"},q=m(()=>t("div",{class:"div"},[t("h1",{class:"bg-danger"},"CANCELED")],-1)),F=[q],R={class:"row d-flex backgroundCover"},U={class:"col-4"},W=["src"],z={class:"col-8"},J={class:"row"},K={class:"col-10"},Q={class:"col-2"},X={class:"mt-3"},Z={class:"row"},$={class:"col-10 d-flex"},ee=m(()=>t("h6",null,"Capacity",-1)),te={key:0,class:"ms-2"},se={key:1,class:"ms-2"},oe={key:0,class:"col-2"},ce={key:1},ne={class:"row mt-2"},ie={class:"col-12"},ae=m(()=>t("h3",null,"See Who is Attending!",-1)),de={class:"border rounded my-3 d-flex"},re=["src","alt","title"],le={class:"row"},me=m(()=>t("div",{class:"col4"},null,-1)),_e={class:"col4"},ve=m(()=>t("h1",null,"Comments",-1)),he={class:"form-group"},ue=m(()=>t("label",{for:"body"},"Share your thoughts!",-1)),ye=m(()=>t("div",{class:"modal-footer"},[t("button",{type:"submit",class:"btn btn-dark"},"Comment")],-1)),ge=m(()=>t("div",{class:"col4"},null,-1)),ke={class:"row"},pe={class:"col-12"},be={class:"card my-2"},fe={class:"card-body elevation-5 text-dark d-flex"},we={class:"col-1 justify-content-end"},Ce=["onClick"],Te=m(()=>t("h5",{class:"mdi mdi-delete-variant","aria-label":"deleteComment"},null,-1)),Ie=[Te],xe={class:"row"},Se={class:"col-2"},Ee=["src","title"],Be={class:"ms-3"},De={key:1,class:"text-light text-center p-5"},Ae=L('<h1 class="display-1" data-v-c53cdb19><i class="mdi mdi-music mdi-spin" data-v-c53cdb19></i><i class="mdi mdi-earth mdi-spin" data-v-c53cdb19></i><i class="mdi mdi-microphone mdi-spin" data-v-c53cdb19></i><i class="mdi mdi-pinwheel mdi-spin" data-v-c53cdb19></i></h1>',1),Ne=[Ae];function Ge(i,o,c,s,g,b){return s.event?(d(),a("div",V,[t("div",Y,[s.event.isCanceled?(d(),a("div",j,F)):y("",!0),t("div",R,[t("div",U,[t("img",{class:"img-fluid",src:s.event.coverImg,alt:""},null,8,W)]),t("div",z,[t("div",J,[t("div",K,[t("h4",null,_(s.event.type),1),t("h1",null,_(s.event.name),1),t("b",null,_(s.event.location),1)]),t("div",Q,_(s.event.startDate),1)]),t("p",X,_(s.event.description),1),t("div",Z,[t("div",$,[ee,s.event.capacity>0?(d(),a("b",te,_(s.event.capacity),1)):(d(),a("b",se,"SOLD OUT"))]),s.event.capacity>0?(d(),a("div",oe,[!s.myTicket&&!s.event.isCanceled?(d(),a("button",{key:0,onClick:o[0]||(o[0]=e=>s.createTicket()),class:"btn btn-warning mdi mdi-human text-center"}," Attend ")):y("",!0),s.myTicket?(d(),a("button",{key:1,onClick:o[1]||(o[1]=e=>s.removeTicket(s.myTicket.id)),class:"btn btn-warning mdi mdi-human text-center"}," Leave ")):y("",!0)])):(d(),a("div",ce,"SoldOut"))])])]),t("div",ne,[t("div",ie,[ae,t("div",de,[(d(!0),a(f,null,w(s.ticket,e=>(d(),a("div",null,[t("img",{class:"img-fluid round-img",src:e.profile.picture,alt:e.name,title:e.profile.name},null,8,re)]))),256))])])]),t("div",le,[me,t("div",_e,[ve,s.account.id?(d(),a("form",{key:0,onSubmit:o[3]||(o[3]=B(e=>s.createComment(),["prevent"]))},[t("div",he,[ue,D(t("textarea",{"onUpdate:modelValue":o[2]||(o[2]=e=>s.editable.body=e),required:"",class:"form-control",id:"body",rows:"3"},null,512),[[A,s.editable.body]])]),ye],32)):y("",!0)]),ge]),t("div",ke,[(d(!0),a(f,null,w(s.comments,e=>(d(),a("div",pe,[t("div",be,[t("div",fe,[t("div",we,[s.account.id==e.creatorId?(d(),a("button",{key:0,onClick:h=>s.deleteComment(e.id),class:"btn btn-danger-outline"},Ie,8,Ce)):y("",!0)]),t("div",xe,[t("div",Se,[t("img",{src:e.picture,alt:"",title:e.name},null,8,Ee)])]),t("p",null,_(e.name),1),t("p",Be,_(e.body),1)])])]))),256))])])])):(d(),a("div",De,Ne))}const Le=T(P,[["render",Ge],["__scopeId","data-v-c53cdb19"]]);export{Le as default};
